<body id=body>
<h2>Digits demo</h2>
<p id=loading>Loading...</p>
<div id=loaded style="display: none">
<hr>
<p>1) Train a network with 60000 handwritten digits
<p>(Hidden nodes: 100, learning rate: 0.2)
<p><button id=train>TRAIN</button><!-- or <button id=load>LOAD a pre-trained network (faster)</button>-->
<p><canvas id=c width=112 height=112 style="background: #000"></canvas>
<p id=progress>Training: 0/60000</p>

<hr>

<p>2) Try to guess 10000 new digits
<p><button id=guess>GUESS</button>
<p id=corrects>Correct: ?/10000</p>
</div>

<script src="../commented.js"></script>
<script src="mnist_train_part_1.js"></script>
<script src="mnist_train_part_2.js"></script>
<script src="mnist_test.js"></script>

<script>
samples = [...mnist_train_part_1, ...mnist_train_part_2];
x = c.getContext("2d");

// Onload
onload = () => {
  loading.remove();
  loaded.style.display = "block";

  // Init
  I(784, 100, 10);
}

// Train
train.onclick = () => {

  // Train
  train.setAttribute("disabled", "1");
  kk = 0;
  
  interval = setInterval(()=>{
    for(ll = 0; ll < 20; ll++){
      if(ll == 0){
        c.width ^= 0;
        for(ii = 28; ii--;){
          for(jj= 28; jj--;){
            col = samples[kk].image[jj*28+ii];
            x.fillStyle = "rgb("+col+","+col+"," + col + ")";
            x.fillRect(ii*4,jj*4,4,4);
          }
        }
        x.fillStyle = "#def";
        x.fillText(samples[kk].label, 104, 109);
      }
    
      target = Array(10).fill(0.01);
      target[samples[kk].label] = 0.99;
    P(samples[kk].image.map(z=> (z / 255.0 * 0.99) + 0.01), target);
      kk++;
    }
    progress.innerHTML = "Training: "+kk+"/60000";
    if(kk >= 60000){
      clearInterval(interval);
      train.removeAttribute("disabled");
      train.innerHTML = "TRAIN AGAIN (optional)";
    }
  },1);
  
}

function findMax(arr) {
  let record = 0;
  let index = 0;
  for (let i = 0; i < arr.length; i++) {
    if (arr[i] > record) {
      record = arr[i];
      index = i;
    }
  }
  return index;
}

guess.onclick = () => {
  correct = 0;
  for(zzz = 0; zzz < 10000; zzz++){
    yyy = P(mnist_test[zzz].image.map(z=> (z / 255.0 * 0.99) + 0.01));
    guess = findMax(yyy);
    if(guess == mnist_test[zzz].label) correct ++;
  }
  corrects.innerHTML = "Correct: " + correct + "/10000 (" + (correct/100) + "% accuracy)";
}

</script>