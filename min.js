for(M=(o,e,n)=>Array(o).fill().map((()=>Array(e).fill(n?0:Math.random()))),D=(o,e)=>o.map(((n,l)=>e[0].map(((t,r)=>n.reduce(((n,t,N)=>n+o[l][N]*e[N][r]),0))))),C=(o,e)=>(e=[],o.map((o=>e.push([o]))),e),A=(o,e,n,l)=>{for(n=0;n<o.length;n++)for(l=0;l<o[0].length;l++)o[n][l]+=e[n][l]},S=(o,e,n,l,t)=>{for(n=M(o.length,o[0].length,1),l=0;l<o.length;l++)for(t=0;t<o[0].length;t++)n[l][t]=o[l][t]-e[l][t];return n},P=(o,e,n,l,t)=>{for(n=M(o.length,o[0].length,1),l=0;l<o.length;l++)for(t=0;t<o[0].length;t++)n[l][t]=o[l][t]*e[l][t];return n},F=(o,e,n,l)=>{for(n=0;n<o.length;n++)for(l=0;l<o[0].length;l++)o[n][l]=e(o[n][l])},R=(o,e,n,l,t)=>{for(n=M(o.length,o[0].length,1),l=0;l<o.length;l++)for(t=0;t<o[0].length;t++)n[l][t]=e*o[l][t];return n},T=(o,e,n,l)=>{for(e=M(o[0].length,o.length,1),n=0;n<o.length;n++)for(l=0;l<o[0].length;l++)e[l][n]=o[n][l];return e},N={init:(o,e,n,l=.1,t=o=>1/(1+Math.exp(-o)),r=o=>o*(1-o))=>{N.l=l,N.f=t,N.g=r,N.wih=M(e,o),N.who=M(n,e),N.bh=M(e,1),N.bo=M(n,1)},query:(o,e,n,l)=>([e,n,l]=N.p(o),l),train:(o,e,n,l,t,r,g,h)=>{[n,l,t]=N.p(o),r=S(C(e),t),F(t,N.g),g=R(P(t,r),N.l),A(N.who,D(g,T(l))),A(N.bo,g),F(l,N.g),h=R(P(l,D(T(N.who),r)),N.l),A(N.wih,D(h,T(n))),A(N.bh,h)},p:(o,e,n,l)=>(e=C(o),n=D(N.wih,e),A(n,N.bh),F(n,N.f),l=D(N.who,n),A(l,N.bo),F(l,N.f),[e,n,l])}