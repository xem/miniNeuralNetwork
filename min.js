M=(N,l,o)=>Array(N).fill().map((()=>Array(l).fill(o?0:Math.random()))),D=(N,l)=>N.map(((o,e)=>l[0].map(((n,r)=>o.reduce(((o,n,g)=>o+N[e][g]*l[g][r]),0))))),O=(N,l,o,e,n,r)=>{for(n=0;n<N.length;n++)for(r=0;r<N[0].length;r++)0==o&&(N[n][r]+=l[n][r]),1==o&&(N[n][r]-=l[n][r]),2==o&&(N[n][r]*=l[n][r]),3==o&&(N[n][r]*=l),4==o&&(N[n][r]=l(N[n][r]))},T=(N,l,o,e)=>{for(l=M(N[0].length,N.length,1),o=0;o<N.length;o++)for(e=0;e<N[0].length;e++)l[e][o]=N[o][e];return l},N={i:(l,o,e,n=.1,r=N=>1/(1+Math.exp(-N)),g=N=>N*(1-N))=>{N.l=n,N.f=r,N.g=g,N.w=M(o,l),N.W=M(e,o),N.b=M(o,1),N.B=M(e,1)},p:(l,o,e,n,r)=>{if(e=l,n=D(N.w,e),O(n,N.b,0),O(n,N.f,4),r=D(N.W,n),O(r,N.B,0),O(r,N.f,4),!o)return r;O(o,r,1),O(r,N.g,4),O(r,o,2),O(r,N.l,3),O(N.W,D(r,T(n)),0),O(N.B,r,0),O(n,N.g,4),O(n,D(T(N.W),o),2),O(n,N.l,3),O(N.w,D(n,T(e)),0),O(N.b,n,0)}}