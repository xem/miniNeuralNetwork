for(M=(o,l,n)=>Array(o).fill().map((()=>Array(l).fill(n?0:Math.random()))),D=(o,l)=>o.map(((n,t)=>l[0].map(((e,N)=>n.reduce(((n,e,g)=>n+o[t][g]*l[g][N]),0))))),C=(o,l)=>(l=[],o.map((o=>l.push([o]))),l),A=(o,l,n,t)=>{for(n=0;n<o.length;n++)for(t=0;t<o[0].length;t++)o[n][t]+=l[n][t]},S=(o,l,n,t,e)=>{for(n=M(o.length,o[0].length,1),t=0;t<o.length;t++)for(e=0;e<o[0].length;e++)n[t][e]=o[t][e]-l[t][e];return n},P=(o,l,n,t,e)=>{for(n=M(o.length,o[0].length,1),t=0;t<o.length;t++)for(e=0;e<o[0].length;e++)n[t][e]=o[t][e]*l[t][e];return n},F=(o,l,n,t)=>{for(n=0;n<o.length;n++)for(t=0;t<o[0].length;t++)o[n][t]=l(o[n][t])},R=(o,l,n,t,e)=>{for(n=M(o.length,o[0].length,1),t=0;t<o.length;t++)for(e=0;e<o[0].length;e++)n[t][e]=l*o[t][e];return n},T=(o,l,n,t)=>{for(l=M(o[0].length,o.length,1),n=0;n<o.length;n++)for(t=0;t<o[0].length;t++)l[t][n]=o[n][t];return l},N={i:(o,l,n,t=.1,e=o=>1/(1+Math.exp(-o)),g=o=>o*(1-o))=>{N.l=t,N.f=e,N.g=g,N.wih=M(l,o),N.who=M(n,l),N.bh=M(l,1),N.bo=M(n,1)},p:(o,l,n,t,e,g,r,h)=>{if(n=C(o),t=D(N.wih,n),A(t,N.bh),F(t,N.f),e=D(N.who,t),A(e,N.bo),F(e,N.f),!l)return e;g=S(C(l),e),F(e,N.g),r=R(P(e,g),N.l),A(N.who,D(r,T(t))),A(N.bo,r),F(t,N.g),h=R(P(t,D(T(N.who),g)),N.l),A(N.wih,D(h,T(n))),A(N.bh,h)}}